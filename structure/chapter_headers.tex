%---------------------------------------------------------------------------------------
%	CHAPTER HEADINGS
%---------------------------------------------------------------------------------------

\makeatletter
% A switch to conditionally include a picture, implemented by Christian Hupfer
\newif\ifusechapterimage
\usechapterimagetrue
\newcommand{\thechapterimage}{}%
\newcommand{\chapterimage}[1]{
    \ifusechapterimage
        \renewcommand{\thechapterimage}{#1}
    \fi
}%
\newcommand{\autodot}{.}
\def\@makechapterhead#1{%
    {
        \parindent \z@ \raggedright \normalfont
        \ifnum \c@secnumdepth >\m@ne
            \begin{tikzpicture}[remember picture,overlay]
                \node at (current page.north west) {
                    \begin{tikzpicture}[remember picture,overlay]
                        \node[anchor=north west,inner sep=0pt] at (0,0) {
                            \ifusechapterimage
                                \includegraphics[width=\paperwidth]{
                                    \thechapterimage
                                }
                            \fi
                        };
                        \draw[anchor=west] (\Gm@lmargin,-9cm) node [
                            line width=2pt,
                            rounded corners=15pt,
                            draw=ocre,
                            fill=white,
                            fill opacity=0.5,
                            inner sep=15pt
                        ]{
                            \strut\makebox[22cm]{}
                        };
                        \draw[anchor=west] (\Gm@lmargin+.3cm,-9cm) node {
                            \huge
                            \sffamily
                            \bfseries
                            \if@mainmatter
                                \color{black}
                                \thechapter\autodot~#1
                            \else
                                \color{black}#1
                            \fi
                            \strut
                        };
                    \end{tikzpicture}
                };
            \end{tikzpicture}
        \fi\par\vspace*{270\p@}
    }
}

%-------------------------------------------

\def\@makeschapterhead#1{%
\begin{tikzpicture}[remember picture,overlay]
    \node at (current page.north west)
    {
        \begin{tikzpicture}[remember picture,overlay]
            \node[
                anchor=north west,
                inner sep=0pt
            ] at (0,0) {
                \ifusechapterimage
                    \includegraphics[width=\paperwidth]{
                        \thechapterimage
                    }
                \fi
            };
            \draw[anchor=west] (\Gm@lmargin,-9cm) node [
                line width=2pt,
                rounded corners=15pt,
                draw=ocre,
                fill=white,
                fill opacity=0.5,
                inner sep=15pt
            ]{
                \strut
                \makebox[22cm]{}
            };
            \draw[anchor=west] (\Gm@lmargin+.3cm,-9cm) node {
                \huge
                \sffamily
                \bfseries
                \color{black}#1
                \strut
            };
        \end{tikzpicture}
    };
\end{tikzpicture}
\par\vspace*{270\p@}}
\makeatother

%---------------------------------------------------------------------------------------